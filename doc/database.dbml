Table AuthorCatalog {
  id int [not null, pk]
  first_name varchar [not null]
  last_name varchar [default: null]
}

Table PublisherCatalog {
  id int [not null, pk]
  name varchar [not null]
}

Table GenreCatalog {
  id int [not null, pk]
  name varchar [not null]
}

Table DeweyClassification {
  id int [not null, pk]
  code varchar [not null]
  description varchar [default: null]
  parent_id int [ref: > DeweyClassification.id, default: null]
}

Table BookCatalog {
  id int [not null, pk]
  publisher_catalog_id int [not null, ref: > PublisherCatalog.id]
  dewey_classification_id int [not null, ref: > DeweyClassification.id]
  title varchar [not null]
  isbn varchar(13) [default: null]
  year_of_publication int [not null]
}

Table BookCatalog_AuthorCatalog {
  book_catalog_id int [not null, ref: > BookCatalog.id]
  author_catalog_id int [not null, ref: > AuthorCatalog.id]

  indexes {
    (book_catalog_id, author_catalog_id) [pk]
  }
}

Table BookCatalog_GenreCatalog {
  book_catalog_id int [not null, ref: > BookCatalog.id]
  genre_catalog_id int [not null, ref: > GenreCatalog.id]

  indexes {
    (book_catalog_id, genre_catalog_id) [pk]
  }
}

Table BookStatusCatalog {
  id int [not null, pk]
  status varchar [not null]
}

Table Book {
  id int [not null, pk]
  status_id int [not null, ref: > BookStatusCatalog.id]
  book_catalog_id int [not null, ref: > BookCatalog.id]
  copy_number int [not null]

  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]

  indexes {
    (book_catalog_id, copy_number) [unique]
  }
}

Table UserRoleCatalog {
  id int [not null, pk]
  role varchar [not null]
}

Table User {
  id int [not null, pk]
  name varchar [not null]
  user_role_catalog_id int [not null, ref: > UserRoleCatalog.id]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

Enum LoanStatus {
  LOANED
  RETURNED
  OVERDUE
  LOST
}

Table Loan {
  id int [not null, pk]
  calculated_by int [ref: > User.id, default: null]
  user_id int [not null, ref: > User.id]
  book_id int [not null, ref: > Book.id]
  loaner_id int [not null, ref: > User.id]
  receiver_id int [not null, ref: > User.id]
  loan_date date [not null, default: `now()`]
  due_date date [not null]
  status LoanStatus [not null, default: `LoanStatus.LOANED`]
  return_date date [default: null]
  final_penalty decimal(7,2) [default: null]
  calculated_at timestamp [default: null]
  replacement_fee decimal(7,2) [default: null]

  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

Table Properties {
  penalty_per_day decimal(5, 2)
  penalty_on_non_working_days bool [default: false]
  penalty_multiplier_on_non_working_days decimal(5, 2) [default: 2.0]
  count_loan_days_in_non_working_days bool [default: false]
  charge_late_fee_and_book_replacement_together bool [default: true]
  max_extensions int
  max_loan_days int
  max_loans_per_user int
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}